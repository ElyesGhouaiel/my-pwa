{"ast":null,"code":"import React,{useEffect,useState}from'react';import'./App.css';import{initializeApp}from'firebase/app';import{getMessaging,getToken as getFCMToken,onMessage}from'firebase/messaging';import{register}from'./serviceWorkerRegistration';// Assurez-vous que ce chemin est correct\n// Configuration Firebase\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const firebaseConfig={apiKey:\"AIzaSyDLu_SNw66YIVs8ruwMGwxnv1DDcxuzbKQ\",authDomain:\"test-1ed88.firebaseapp.com\",projectId:\"test-1ed88\",storageBucket:\"test-1ed88.firebasestorage.app\",messagingSenderId:\"240250228794\",appId:\"1:240250228794:web:ddef4fee8b65752e5d6503\",measurementId:\"G-NCX2XWPCS9\"};// Initialisation de Firebase\nconst app=initializeApp(firebaseConfig);const messaging=getMessaging(app);function App(){const[notification,setNotification]=useState({title:'',body:''});// Enregistrement du service worker\nuseEffect(()=>{register({onUpdate:registration=>{console.log('Service Worker updated:',registration);},onSuccess:registration=>{console.log('Service Worker registered:',registration);}});},[]);// Demande de permission pour les notifications\nconst requestPermission=async()=>{console.log('Demande de permission...');try{const permission=await Notification.requestPermission();if(permission==='granted'){console.log('Permission accordée.');await fetchFCMToken();// Appel à la fonction pour récupérer le token FCM\n}else{console.error('Permission refusée');}}catch(error){console.error('Erreur lors de la demande de permission:',error);}};// Récupération du token FCM\nconst fetchFCMToken=async()=>{try{const vapidKey='BIsFRIerqr3JOxS93ZSk5Giq-Rt81E2sdErv5HGKOA-hS8t3mTxtQQr8jwLDqRomJ3STyTNSlbv_SXBL97IdJiA';const token=await getFCMToken(messaging,{vapidKey});if(token){console.log('Token FCM:',token);// Envoyez ce token à votre serveur ici\n}else{console.log('Aucun token d\\'enregistrement disponible.');}}catch(err){console.error('Une erreur est survenue lors de la récupération du token :',err);}};// Gestion des messages reçus lorsque l'application est au premier plan\nuseEffect(()=>{requestPermission();// Demande de permission lors du premier rendu\nconst unsubscribe=onMessage(messaging,payload=>{console.log('Message reçu:',payload);setNotification({title:payload.notification.title,body:payload.notification.body});});return()=>unsubscribe();// Nettoyage à la désinscription\n},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Ma PWA React avec Notifications Push\"}),/*#__PURE__*/_jsx(\"button\",{onClick:requestPermission,children:\"Demander la permission pour les notifications\"}),notification.title&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Derni\\xE8re notification :\"}),/*#__PURE__*/_jsx(\"p\",{children:notification.title}),/*#__PURE__*/_jsx(\"p\",{children:notification.body})]})]})});}export default App;","map":{"version":3,"names":["React","useEffect","useState","initializeApp","getMessaging","getToken","getFCMToken","onMessage","register","jsx","_jsx","jsxs","_jsxs","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","app","messaging","App","notification","setNotification","title","body","onUpdate","registration","console","log","onSuccess","requestPermission","permission","Notification","fetchFCMToken","error","vapidKey","token","err","unsubscribe","payload","className","children","onClick"],"sources":["C:/Users/yujir/Documents/ynov/app pwa/my-pwa/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport './App.css';\nimport { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken as getFCMToken, onMessage } from 'firebase/messaging';\nimport { register } from './serviceWorkerRegistration'; // Assurez-vous que ce chemin est correct\n\n// Configuration Firebase\nconst firebaseConfig = {\n  apiKey: \"AIzaSyDLu_SNw66YIVs8ruwMGwxnv1DDcxuzbKQ\",\n  authDomain: \"test-1ed88.firebaseapp.com\",\n  projectId: \"test-1ed88\",\n  storageBucket: \"test-1ed88.firebasestorage.app\",\n  messagingSenderId: \"240250228794\",\n  appId: \"1:240250228794:web:ddef4fee8b65752e5d6503\",\n  measurementId: \"G-NCX2XWPCS9\"\n};\n\n// Initialisation de Firebase\nconst app = initializeApp(firebaseConfig);\nconst messaging = getMessaging(app);\n\nfunction App() {\n  const [notification, setNotification] = useState({ title: '', body: '' });\n\n  // Enregistrement du service worker\n  useEffect(() => {\n    register({\n      onUpdate: registration => {\n        console.log('Service Worker updated:', registration);\n      },\n      onSuccess: registration => {\n        console.log('Service Worker registered:', registration);\n      }\n    });\n  }, []);\n\n  // Demande de permission pour les notifications\n  const requestPermission = async () => {\n    console.log('Demande de permission...');\n    try {\n      const permission = await Notification.requestPermission();\n      if (permission === 'granted') {\n        console.log('Permission accordée.');\n        await fetchFCMToken(); // Appel à la fonction pour récupérer le token FCM\n      } else {\n        console.error('Permission refusée');\n      }\n    } catch (error) {\n      console.error('Erreur lors de la demande de permission:', error);\n    }\n  };\n\n  // Récupération du token FCM\n  const fetchFCMToken = async () => {\n    try {\n      const vapidKey = 'BIsFRIerqr3JOxS93ZSk5Giq-Rt81E2sdErv5HGKOA-hS8t3mTxtQQr8jwLDqRomJ3STyTNSlbv_SXBL97IdJiA';\n      const token = await getFCMToken(messaging, { vapidKey });\n      \n      if (token) {\n        console.log('Token FCM:', token);\n        // Envoyez ce token à votre serveur ici\n      } else {\n        console.log('Aucun token d\\'enregistrement disponible.');\n      }\n    } catch (err) {\n      console.error('Une erreur est survenue lors de la récupération du token :', err);\n    }\n  };\n\n  // Gestion des messages reçus lorsque l'application est au premier plan\n  useEffect(() => {\n    requestPermission(); // Demande de permission lors du premier rendu\n\n    const unsubscribe = onMessage(messaging, (payload) => {\n      console.log('Message reçu:', payload);\n      setNotification({\n        title: payload.notification.title,\n        body: payload.notification.body\n      });\n    });\n\n    return () => unsubscribe(); // Nettoyage à la désinscription\n  }, []);\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h1>Ma PWA React avec Notifications Push</h1>\n        <button onClick={requestPermission}>Demander la permission pour les notifications</button>\n        {notification.title && (\n          <div>\n            <h2>Dernière notification :</h2>\n            <p>{notification.title}</p>\n            <p>{notification.body}</p>\n          </div>\n        )}\n      </header>\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}