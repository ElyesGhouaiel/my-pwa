{"ast":null,"code":"\"use strict\";\n\n/**\r\n * Copyright 2024 Google LLC. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EnabledTraceUtil = void 0;\nconst api_1 = require(\"@opentelemetry/api\");\nconst span_1 = require(\"./span\");\nclass EnabledTraceUtil {\n  constructor(settings) {\n    var _a;\n    let tracerProvider = (_a = settings.openTelemetryOptions) === null || _a === void 0 ? void 0 : _a.tracerProvider;\n    // If a TracerProvider has not been given to us, we try to use the global one.\n    if (!tracerProvider) {\n      const {\n        trace\n      } = require('@opentelemetry/api');\n      tracerProvider = trace.getTracerProvider();\n    }\n    const libVersion = require('../../../package.json').version;\n    const libName = require('../../../package.json').name;\n    this.tracer = tracerProvider.getTracer(libName, libVersion);\n  }\n  endSpan(otelSpan, error) {\n    otelSpan.setStatus({\n      code: api_1.SpanStatusCode.ERROR,\n      message: error.message\n    });\n    otelSpan.recordException(error);\n    otelSpan.end();\n  }\n  startActiveSpan(name, fn, attributes) {\n    return this.tracer.startActiveSpan(name, {\n      attributes: attributes\n    }, otelSpan => {\n      // Note that if `fn` returns a `Promise`, we want the otelSpan to end\n      // after the `Promise` has resolved, NOT after the `fn` has returned.\n      // Therefore, we should not use a `finally` clause to end the otelSpan.\n      try {\n        let result = fn(new span_1.Span(otelSpan));\n        if (result instanceof Promise) {\n          result = result.then(value => {\n            otelSpan.end();\n            return value;\n          }).catch(error => {\n            this.endSpan(otelSpan, error);\n            // Returns a Promise.reject the same as the underlying function.\n            return Promise.reject(error);\n          });\n        } else {\n          otelSpan.end();\n        }\n        return result;\n      } catch (error) {\n        this.endSpan(otelSpan, error);\n        // Re-throw the exception to maintain normal error handling.\n        throw error;\n      }\n    });\n  }\n  startSpan(name) {\n    return new span_1.Span(this.tracer.startSpan(name, undefined, api_1.context.active()));\n  }\n  currentSpan() {\n    return new span_1.Span(api_1.trace.getActiveSpan());\n  }\n}\nexports.EnabledTraceUtil = EnabledTraceUtil;","map":{"version":3,"names":["Object","defineProperty","exports","value","EnabledTraceUtil","api_1","require","span_1","constructor","settings","_a","tracerProvider","openTelemetryOptions","trace","getTracerProvider","libVersion","version","libName","name","tracer","getTracer","endSpan","otelSpan","error","setStatus","code","SpanStatusCode","ERROR","message","recordException","end","startActiveSpan","fn","attributes","result","Span","Promise","then","catch","reject","startSpan","undefined","context","active","currentSpan","getActiveSpan"],"sources":["C:/Users/yujir/Documents/ynov/app pwa/mypwafinal/my-pwa/node_modules/@google-cloud/firestore/build/src/telemetry/enabled-trace-util.js"],"sourcesContent":["\"use strict\";\r\n/**\r\n * Copyright 2024 Google LLC. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.EnabledTraceUtil = void 0;\r\nconst api_1 = require(\"@opentelemetry/api\");\r\nconst span_1 = require(\"./span\");\r\nclass EnabledTraceUtil {\r\n    constructor(settings) {\r\n        var _a;\r\n        let tracerProvider = (_a = settings.openTelemetryOptions) === null || _a === void 0 ? void 0 : _a.tracerProvider;\r\n        // If a TracerProvider has not been given to us, we try to use the global one.\r\n        if (!tracerProvider) {\r\n            const { trace } = require('@opentelemetry/api');\r\n            tracerProvider = trace.getTracerProvider();\r\n        }\r\n        const libVersion = require('../../../package.json').version;\r\n        const libName = require('../../../package.json').name;\r\n        this.tracer = tracerProvider.getTracer(libName, libVersion);\r\n    }\r\n    endSpan(otelSpan, error) {\r\n        otelSpan.setStatus({\r\n            code: api_1.SpanStatusCode.ERROR,\r\n            message: error.message,\r\n        });\r\n        otelSpan.recordException(error);\r\n        otelSpan.end();\r\n    }\r\n    startActiveSpan(name, fn, attributes) {\r\n        return this.tracer.startActiveSpan(name, {\r\n            attributes: attributes,\r\n        }, (otelSpan) => {\r\n            // Note that if `fn` returns a `Promise`, we want the otelSpan to end\r\n            // after the `Promise` has resolved, NOT after the `fn` has returned.\r\n            // Therefore, we should not use a `finally` clause to end the otelSpan.\r\n            try {\r\n                let result = fn(new span_1.Span(otelSpan));\r\n                if (result instanceof Promise) {\r\n                    result = result\r\n                        .then(value => {\r\n                        otelSpan.end();\r\n                        return value;\r\n                    })\r\n                        .catch(error => {\r\n                        this.endSpan(otelSpan, error);\r\n                        // Returns a Promise.reject the same as the underlying function.\r\n                        return Promise.reject(error);\r\n                    });\r\n                }\r\n                else {\r\n                    otelSpan.end();\r\n                }\r\n                return result;\r\n            }\r\n            catch (error) {\r\n                this.endSpan(otelSpan, error);\r\n                // Re-throw the exception to maintain normal error handling.\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n    startSpan(name) {\r\n        return new span_1.Span(this.tracer.startSpan(name, undefined, api_1.context.active()));\r\n    }\r\n    currentSpan() {\r\n        return new span_1.Span(api_1.trace.getActiveSpan());\r\n    }\r\n}\r\nexports.EnabledTraceUtil = EnabledTraceUtil;\r\n//# sourceMappingURL=enabled-trace-util.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}